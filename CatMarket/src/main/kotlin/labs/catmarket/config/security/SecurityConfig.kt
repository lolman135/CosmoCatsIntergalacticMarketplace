package labs.catmarket.config.security

import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration
import org.springframework.security.config.annotation.web.builders.HttpSecurity
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity
import org.springframework.security.config.annotation.web.invoke
import org.springframework.security.web.SecurityFilterChain
import java.beans.BeanProperty

@Configuration
@EnableWebSecurity
class SecurityConfig {

    @Bean
    fun githubIntrospector() = GitHubOpaqueTokenIntrospector()

    @Bean
    fun securityFilterChain(http: HttpSecurity) : SecurityFilterChain{

        http{
            csrf { disable() }
            cors { disable() }
            authorizeHttpRequests {
                authorize(anyRequest, authenticated)
            }

            oauth2Login {
                loginPage = "/oauth2/authorization/github"
            }

            oauth2ResourceServer {
                opaqueToken { introspector = githubIntrospector() }
            }

            logout {
                logoutSuccessUrl = "/"
            }
        }
        return http.build()
    }

    /*                    ME WHEN NO KAFKA
     :=-        ..  ........  ...............................
    =@@%+*#*+#%##++*##*#####****##*###########*****##########%%##***#*+****#
    -%@#**=+#%%*+++*###########*##*############################%###++******#
    =@@*++*%%#+=+**####****#####***#**#*#####################*###%#*+++*+**#
    =@@++#%%*+=++*****####*****###***##*******#***#############**+##*+##****
    +@@=*%#++==+*#####************#*****#######*##***############+-+#**#****
    *@%+%*+--=*#####***+************#####*#*#******#**#####**##*##++*#******
    %@*++=:-+###*#*****++****************########*###*****####**************
    *@+::-+#%########*#++***************++***#############*##***+*#*+**#**##
    *#.=*#%##*#****##*#*++**************+++====+++*############***++********
    =:*##******++==****#+=++***********##*#*+++++===+************+***+*****+
     -+**++==---+#@@@##*%+=+**********#*#**##**+++++=++*********++++++*#**+.
     :---==+*%@@@@@@##%+%@+.-+**************##***++++++++**+**+**+++******:=+
    #@@@@@@@@@@@@@#++*%*=@@@+--=++********+*****#**++++***+++++++++***##*--@-
    %@@@@@@@@@@%*++**+*#+=+@@@%+---===----=---=+**##**++++++++++*+******::@@:
    #@@@@%#*====+******%#*+:-@@@@@%#*##@@@@%@%*+==+***++++++++++++*##**-:@@%.
    -@@#--=+++***********##*=:-@@@@@@@@@@@@@@@@@@%*+*#**++=+++++*####+:.@@#+.
    =%%@#:-+##***#*##******##*+-:-%@@@@@@@@@@@@@@@@%**#*+++=+=+*####+.+@@+*@@
    =%%@@@*:-**##*****##***#%#**+==-::--%@@@@@@@%@@@%****+=+=+*###*:.@@**@@@
    +%%%%@@@%---==+=+**#*+*#%#*####***++=:..:+@@@@@@@***++=-=*#%*-.+@%*@@@++.
    +@@@@@@@@@#*@@@@#==+*+*##**###**********+=--+%@@@@%*++=-***:.+@@%@@@+*#%:
    +@@%%%@@@@@@* -@@@@#+=+#%#####*******#******+=-+%@@*+=-+#+*@@@@@@@**#%%%:
    +@@@@@@@@@@.  -%@@@@@:+#%###***#@@@#+==+*******+=#@#+==*+@@@- :@#*%%%%%%-
    *@@@@@%@@@@  +@@@.  @-+#%##*#@@@@@@@@@@@+=+**##**#@*=:-=+%- .-@@%%%%%%%%-
    *@@@@@@@%@@  *@@@@@@@:+%####@@-  *##@@@@@@%+#####%#=..%@@#@%*@@@@@%%%%%%-
    #@@@%++@@+-@@ .@@%@@@.*%#**@@+.  @@@:=@@@@@@#%@@@@*..@@*.=+@@%%@@@@%%%%%=
    #%**@@@@@-.#@@@@@@@#.-#%*##@@-..@@@+ .@@%:@@%*#%@#:.@@@*##@@@@@@#%%@%%%%=
    =@@@@@@@@+.+*%@@@@+.:*##***%@-..@@@@@@@@= -@+---::.=#: -@@@@@@@@@@##%@@%+
    @@@@@@@@@@:++++--:::+%%%#%%#@@#  :+:-#%=:@@+:-=--..=#@@@@@@@@@@@@@@@%*#@+
    :+#@@@%#%%-+*##*=--#%@%#*#%@@@@@@@%@@@%%@%*===--. *@@@@@@@@@@@@@@@@@@@@*-
    .=%@*-=+#@++@#+==*%%%%##***##%@@@@%%%%@@*=----:  @@@%@%@@@@@@@@@@@@@@@@@@
    @@%**%@@@@**#+==*%%%%%###*****++*****+--====+=:-@@@@@@@@@@@@@@@@@@@@@@@@@
    @@@@@@@@@@@=+==+%%###%#######*++++++**####%%%*=@%#+-@@@@@@@@@@@@@@@@@@@@%
    #@@@****@@--==*%%###***##############%%%%%%%*-@@@@:@%#@@@@@@@%@@@@@@@@@@%
    *@@@%###@+:=+#%#++++===+*##*##*############+.+..@*@%%##*#%%+@@ @@@%@@@@@%
    #%@@%#@@@==*##*+===--=+**+==#%%#**########+ +@@:-=*#####@@@@@ -@@@@@@@@@%
    #@@@@#@@+-+*#*+=--::-=+++=-*%%%%#####%###+..@@%.@#++*####*@@%@@@@@@@@@@@%
    #@@@@@@=:=+=+=---::-==-:-=%@%%######%##*+. @@@@@@@%####%%#****+*%@@@@@@@%
    #@@@@= .:-=-=-::-:::=*%@@@@@%%%######*++. @@@@@@@@@@%%#%#%%%%%#*+*%@@@@@%
    *@%%@#-*=--::.:::-+@@@@#****#%%%###*++=. @@@@@@@@@@@@@@%@@@@@%%%%#*+#@%@@
    *@%@@@=+%#+====+%@@#=:::::-++##%%%#*+=. @@@@@@@@@@@@@@@@@@@@@@@%%%%%#*%@+
    *@#@@#@*=+##%@@%*:. .....  .:+*%%#*+=..@@@@@@@@@@@@@@@@@@@@@**@@@%%%%%#%#
    =++%%#@@@@@ .-==+#*=:. ..=-    ..     @@@#%##%%#%%%@@%@@@@@@@@%#@@%###**+
     */
}